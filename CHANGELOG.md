# Changelog
## [2.1.0] - 2025-11-09

### 新增
- **：Lighter 交易所集成** 提供純 HTTP 的 Lighter 永續交易支持
  - 實作自簽名 REST 客戶端，整合原生 signer 並支援簽章執行
  - 支援永續合約做市和 Maker-Taker 對沖策略
  - 解析 Lighter 成交資料時保留原始費率並避免誤計實際手續費，零手續費帳戶可正確記帳

- CLI 命令行界面新增 Paradex 交易所選項

### 文檔
- 新增 Lighter 配置說明到 `.env.example`
- 添加 Lighter 使用示例到 README

## [2.0.0] - 2025-11-03

### 新增
- **Web 控制台界面**：全新的圖形化管理界面，提供直觀的策略控制和實時監控
  - 基於 Flask + Socket.IO 的 Web 服務器實現
  - 響應式設計的專業級儀表板（深色主題）
  - 實時數據推送，每 5 秒自動更新統計信息
  - 支援通過瀏覽器啟動/停止做市策略
  - 可視化展示交易統計、盈虧分析、成交量分佈
  - WebSocket 心跳機制保持連接穩定
  - 支援多瀏覽器標籤頁同步查看
- **策略停止機制優化**：新增 `_stop_flag` 標誌和 `stop()` 方法，支援優雅停止
- **統計數據保留**：策略停止後保留最後統計數據，方便查看最終結果
- 新增 `--web` 命令行參數，快速啟動 Web 服務器

### 修復
- **Paradex API 端點修正**：餘額查詢從 `/balance` 改為 `/account`，並優化數據解析
- **倉位信息增強**：Paradex 倉位查詢返回值新增 `unrealizedPnl` 字段

### 優化
- 改進多種 PnL 返回格式的處理，增強容錯能力
- 優化 Web 界面的數據展示邏輯，處理多種返回類型
- 增強線程安全性，策略線程與統計更新線程獨立運行

### 文檔
- 更新 README 新增 Web 控制台使用說明
- 添加 Web 界面功能特性和使用示例
- 新增 Web 控制台界面截圖
- 更新依賴列表，添加 Flask 相關套件

## [1.5.0] - 2025-10-29

### 新增
- **Paradex 交易所集成**：完整支援 Paradex 永續合約交易
  - 實現基於 EIP-712 簽名的 JWT 認證機制
  - 自動 JWT token 刷新功能，提前 5 分鐘自動更新避免過期
  - 支援永續合約做市和 Maker-Taker 對沖策略
  - 使用 Paradex 私鑰進行請求簽名
- Maker-Taker 對沖策略現貨/永續通用化，掛單成交後自動以市價減倉
- `run.py` 與 CLI 支援 `maker_hedge` 策略選項，可於現貨或永續啟動對沖模式
- Maker-Taker 對沖策略適配 Aster 永續交易所，移除不支援的訂單欄位並保留 reduce-only 市價對沖
- CLI 命令行界面新增 Paradex 交易所選項

### 文檔
- 更新 README 說明新策略使用方式與命令範例
- 新增 Paradex 配置說明到 `.env.example`
- 添加 Paradex 使用示例到 README

## [1.4.3] - 2025-10-08

## 新增
- 新增手動啟動 關閉資料庫紀錄並移除面板功能，提升部署彈性。
- 新增止損 止盈功能，增強風險控管能力。

## 修復
- 修正 Aster 訂單信息統計、CLI 缺少 API Key、止損為負值、市價平倉錯誤、價格獲取與 WebSocket 連線等問題，確保交易流程與連線穩定。

## 優化
- 增設 WS 備援、可配置代理與日誌輸出優化，強化監控與故障恢復能力。
- 更新 README、CHANGELOG 建議參數等文件與設定。
- 統一 CLI 與系統輸出文字、移除 panel 功能。
- 資料庫紀錄啟停流程優化。

## [1.4.2] - 2025-09-26

### 新增

- 為永續合約做市策略新增基於未實現盈虧的止損/止盈風控，觸發時自動取消掛單、平倉並在完成後繼續做市
- 在命令列與 `run.py` 入口提供 `--stop-loss`、`--take-profit` 參數配置止損止盈閾值

### 文檔

- 更新 README 說明新的永續止損/止盈參數與使用範例

## [1.4.1] - 2025-09-25

### 新增
- 新增 Aster 交易所支援。

## [1.4.0] - 2025-09-22

### 新增
- **Base Client 架構**：抽象基礎類別，統一不同交易所的 API 介面
- **精確倉位管理**：只平掉超出閾值的部分，避免過度平倉風控
- **分層日誌系統**：市場狀態、策略決策、價格計算、執行結果四層資訊
- **相容性設計**：支援多種 API 回應格式，強化錯誤處理機制

## [1.3.0] - 2025-09-18

### 新增
- **新增永續合約 (`perp`) 做市功能**：在原有的現貨做市基礎上，擴展支援永續合約交易，採用**風險中性庫存管理**策略。
- **引入目標絕對持倉量 (`target_position`)**：此參數讓用户設定期望維持的庫存大小（絕對值）。策略以被動成交來建立庫存，並在倉位**超過**目標時自動執行減倉，以控制總曝險。
- **實現報價偏移以對沖風險 (`inventory_skew`)**：新增了核心的風險管理機制。此功能會根據當前的**淨倉位 (net position)** 動態調整買賣報價：
    - 當持有多頭倉位時，會降低整體報價以鼓勵賣出。
    - 當持有空頭倉位時，會提高整體報價以鼓勵買入。
    - 其最終目標是持續將**淨倉位**推向零，達成**方向風險中性 (Delta-Neutral)**。
- **新增倉位硬頂風控 (`max_position`)**：設立一個絕對的持倉量上限，一旦觸及，策略會立即強制平倉超出部分，確保風險不會無限擴大。
- **專門的策略模塊**：添加 `strategies/perp_market_maker.py` 檔案，用於處理所有永續合約的專有邏輯。
- **更新用户介面**：在 `run.py` 的命令列參數和 `commands.py` 的互動介面中，加入了完整的永續合約做市設定選項。

## [1.2.0] - 2025-07-04

### 新增
- 支援計算抵押品餘額並整合至總資產統計
- 新增重平衡參數設定，可調整目標比例與觸發閾值
- CLI 與 run.py 提供重平衡開關與模擬測試介面

### 修復
- 修正科學記號價格步長計算
- 修正重平邏輯與資產比例設定，移除歷史交易資料獲取
- 修正價格取得與 WebSocket 斷線異常

### 優化
- 更新依賴版本並改善日誌輸出格式


## [1.1.2] - 2025-04-10

### 新增

- 添加 WebSocket 代理連接支持，允許通過代理服務器連接

### 優化

- 自動終止程序功能：當 API 簽名創建失敗時立即停止運行，防止無效操作


## [1.1.1] - 2025-04-09

### 新增

- 徹底改進重平衡機制風險評估方法，基於總資產價值而非累計交易量
- 添加動態風險暴露度計算，對實際風險提供更精確的評估
- 為重平衡決策添加詳細日誌，包括淨部位價值和風險暴露比例

### 優化

- 完善重平衡系統的錯誤處理，確保網絡或API問題時仍能正常運作
- 為風險判斷增加備用機制，在資產數據無法獲取時回退至舊方法

### 安全

- 改進風險評估算法，防止在大量交易累積後風險被系統性低估

## [1.1.0] - 2025-04-09

### 新增

- 為 WebSocket 客户端添加專門的日誌標識，使日誌更易識別
- 在心跳檢測失敗時添加更詳細的日誌記錄

### 修改

- 將 WebSocket 相關的日誌改名為 `backpack_ws`，使日誌更具描述性

### 修復

- 徹底重構 WebSocket 斷線重連機制，解決連接無法完全重置的問題
- 修復 WebSocket 斷線後資源未完全釋放的問題
- 改進 `on_close` 處理邏輯，使用獨立線程進行重連以避免阻塞回調
- 優化連接關閉邏輯，確保所有相關資源和線程都被正確清理
- 增強 WebSocket 心跳檢測機制，更快偵測並恢復中斷的連接

## [1.0.0] - 2025-04-08

### 新增

- 實現基礎做市策略與 WebSocket 即時數據連接
- 建立命令列介面與互動式面板
- 完成設定檔管理及資料庫支援
- 實現日誌系統並提供完整 README 説明